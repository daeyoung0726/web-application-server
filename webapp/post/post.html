<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Details</title>
</head>
<body>
<h1>게시글 상세</h1>
<div id="postDetails"></div>
<a href="update-post.html" id="updateLink">수정</a>
<form id="deleteForm" method="post" style="display:inline;">
    <button type="button" onclick="deletePost()">삭제</button>
</form>

<script>
    // URL에서 id 파라미터 가져오기
    function getPostIdFromUrl() {
        const params = new URLSearchParams(window.location.search);
        return params.get('id');
    }

    // 게시글 상세 정보 가져오기
    async function fetchPostDetails() {
        const postId = getPostIdFromUrl();
        if (!postId) {
            console.error('게시글 ID가 없습니다.');
            return;
        }

        try {
            const response = await fetch(`/posts/${postId}`);
            if (!response.ok) {
                throw new Error('게시글을 가져오지 못했습니다.');
            }
            const post = await response.json();
            const postDetails = document.getElementById('postDetails');
            postDetails.innerHTML = `
                    <h2>${post.title}</h2>
                    <p>${post.content}</p>
                `;

            // 수정 링크에 ID 추가
            document.getElementById('updateLink').href = `update-post.html?id=${postId}`;
        } catch (error) {
            console.error('Error fetching post details:', error);
        }
    }

    // 게시글 삭제하기
    async function deletePost() {
        const postId = getPostIdFromUrl();
        if (!postId) {
            console.error('게시글 ID가 없습니다.');
            return;
        }

        try {
            const response = await fetch(`/posts/${postId}/delete`, {
                method: 'POST'
            });
            if (response.ok) {
                alert('게시글이 삭제되었습니다.');
                window.location.href = 'index.html'; // 메인 페이지로 이동
            } else {
                throw new Error('게시글 삭제 실패');
            }
        } catch (error) {
            console.error('Error deleting post:', error);
            alert('게시글 삭제에 실패했습니다.');
        }
    }

    // 페이지 로드 시 게시글 상세 정보 가져오기
    window.onload = fetchPostDetails;
</script>
</body>
</html>
